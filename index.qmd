---
title: "BBB 26 ‚Äî Painel de Rea√ß√µes"
subtitle: "An√°lise estrat√©gica do Big Brother Brasil 2026 ‚Äî rea√ß√µes, rela√ß√µes, votos e din√¢micas de poder"
lang: pt-BR
format:
  html:
    code-tools: false
execute:
  echo: false
  warning: false
---

```{python}
#| label: setup
#| include: false

import json
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import matplotlib.colors as mcolors
import seaborn as sns
import plotly.express as px
import plotly.graph_objects as go
from plotly.subplots import make_subplots
from pathlib import Path
from collections import defaultdict, Counter
from datetime import datetime

import sys
sys.path.append(str(Path("scripts").resolve()))
from data_utils import (
    require_clean_manual_events, setup_bbb_dark_theme,
    REACTION_EMOJI, REACTION_SLUG_TO_LABEL, SENTIMENT_WEIGHTS,
    POSITIVE, MILD_NEGATIVE, STRONG_NEGATIVE, GROUP_COLORS,
    POWER_EVENT_EMOJI, POWER_EVENT_LABELS,
    ANALYSIS_DESCRIPTIONS, render_cronologia_html,
)

require_clean_manual_events()
setup_bbb_dark_theme()

# Configura√ß√µes visuais
plt.rcParams['figure.figsize'] = (14, 8)
plt.rcParams['font.size'] = 11
sns.set_theme(style="whitegrid", palette="husl")

# Diret√≥rios
DERIVED_DIR = Path("data/derived")
INDEX_DATA_FILE = DERIVED_DIR / "index_data.json"

MEMBER_OF = {}  # preenchido ao carregar dados
```

```{python}
#| label: load-data

index_data = {}
if INDEX_DATA_FILE.exists():
    with open(INDEX_DATA_FILE, encoding="utf-8") as f:
        index_data = json.load(f)

if not index_data:
    raise RuntimeError("index_data.json n√£o encontrado. Execute scripts/build_derived_data.py")

latest = index_data.get("latest", {})
current_week = index_data.get("current_week")
current_cycle_week = index_data.get("current_cycle_week")
active_names = index_data.get("active_names", [])
MEMBER_OF = index_data.get("member_of", {})
AVATARS = index_data.get("avatars", {})
```

```{python}
#| label: viz-functions
#| include: false

def make_sentiment_ranking(rows, title_suffix="", fixed_height=None):
    """Retorna go.Figure com ranking horizontal de sentimento."""
    if not rows:
        return go.Figure()

    df_sent = pd.DataFrame(rows).sort_values('score', ascending=True)

    color_map = {name: GROUP_COLORS.get(m, '#999')
                 for name, m in zip(df_sent['name'], df_sent['group'])}

    fig = go.Figure()
    fig.add_trace(go.Bar(
        y=df_sent['name'],
        x=df_sent['score'],
        orientation='h',
        marker_color=[color_map[n] for n in df_sent['name']],
        text=[f"{s:+.1f}" for s in df_sent['score']],
        textposition='outside',
        hovertemplate='%{y}: %{x:+.1f}<br>‚ù§Ô∏è: %{customdata[0]} | Neg: %{customdata[1]}<extra></extra>',
        customdata=list(zip(df_sent['hearts'], df_sent['negative'])),
        showlegend=False
    ))

    title = "Ranking de Sentimento"
    if title_suffix:
        title += f" ‚Äî {title_suffix}"

    left_margin = 150
    chart_height = fixed_height if fixed_height else max(500, len(df_sent) * 32)

    fig.update_layout(
        title=title,
        xaxis_title="Score de Sentimento",
        yaxis_title="",
        height=chart_height,
        margin=dict(l=left_margin),
        shapes=[dict(type='line', x0=0, x1=0, y0=-0.5, y1=len(df_sent)-0.5,
                     line=dict(color='red', dash='dash', width=1))]
    )

    for group, color in GROUP_COLORS.items():
        fig.add_trace(go.Scatter(
            x=[None], y=[None], mode='markers',
            marker=dict(size=10, color=color),
            name=group, showlegend=True
        ))

    return fig


def make_cross_table_heatmap(participants, matrix, title_suffix=""):
    """Retorna go.Figure com heatmap da tabela cruzada de rea√ß√µes."""
    active_names_ht = sorted([p['name'] for p in participants
                              if not p.get('characteristics', {}).get('eliminated')])

    heat_data = np.zeros((len(active_names_ht), len(active_names_ht)))
    rxn_labels = []
    for i, giver in enumerate(active_names_ht):
        row_labels = []
        for j, receiver in enumerate(active_names_ht):
            if giver == receiver:
                heat_data[i, j] = np.nan
                row_labels.append('‚Äî')
            else:
                rxn = matrix.get((giver, receiver), '')
                weight = SENTIMENT_WEIGHTS.get(rxn, 0)
                heat_data[i, j] = weight
                emoji = REACTION_EMOJI.get(rxn, '?')
                row_labels.append(emoji)
        rxn_labels.append(row_labels)

    short_names = [n.split()[0] if len(n) > 12 else n for n in active_names_ht]

    fig = go.Figure(data=go.Heatmap(
        z=heat_data,
        x=short_names,
        y=short_names,
        colorscale=[
            [0, '#d73027'],
            [0.25, '#fc8d59'],
            [0.5, '#ffffbf'],
            [1.0, '#1a9850'],
        ],
        zmin=-1, zmax=1,
        text=[[rxn_labels[i][j] for j in range(len(active_names_ht))] for i in range(len(active_names_ht))],
        texttemplate='%{text}',
        textfont=dict(size=14),
        hovertemplate='%{y} ‚Üí %{x}: %{text}<extra></extra>',
        colorbar=dict(title="Sentimento", tickvals=[-1, -0.5, 0, 1],
                      ticktext=['Forte Neg', 'Leve Neg', 'Neutro', 'Positivo'])
    ))

    title = "Mapa de Rea√ß√µes"
    if title_suffix:
        title += f" ‚Äî {title_suffix}"

    fig.update_layout(
        title=title,
        xaxis_title="Receptor ‚Üê",
        yaxis_title="Emissor ‚Üí",
        height=750,
        xaxis=dict(tickangle=45, side='bottom'),
        yaxis=dict(autorange='reversed')
    )

    return fig


def make_cross_table_html(cross_data, title_suffix=""):
    """Retorna HTML string com tabela cruzada de rea√ß√µes (sticky header/column)."""
    active_names = cross_data.get("names", [])
    matrix = cross_data.get("matrix", [])
    short_names = [n.split()[0] if len(n) > 10 else n for n in active_names]

    # Color mapping based on sentiment
    def get_cell_style(rxn):
        if not rxn:
            return "background: #444; color: #888;"
        weight = SENTIMENT_WEIGHTS.get(rxn, 0)
        if weight == 1:  # Positive
            return "background: #1a9850; color: #fff;"
        elif weight == -0.5:  # Mild negative
            return "background: #fc8d59; color: #000;"
        elif weight == -1:  # Strong negative
            return "background: #d73027; color: #fff;"
        return "background: #ffffbf; color: #000;"

    # Build HTML table
    html = []
    html.append(f'''
<div style="overflow-x: auto; max-width: 100%;">
<style>
.cross-table {{
    border-collapse: separate;
    border-spacing: 0;
    font-size: 0.85rem;
    width: max-content;
}}
.cross-table th, .cross-table td {{
    padding: 4px 6px;
    text-align: center;
    border: 1px solid #555;
    min-width: 36px;
    white-space: nowrap;
}}
.cross-table thead th {{
    position: sticky;
    top: 0;
    background: #222;
    z-index: 2;
    font-weight: bold;
}}
.cross-table tbody th {{
    position: sticky;
    left: 0;
    background: #222;
    z-index: 1;
    font-weight: bold;
    text-align: right;
}}
.cross-table thead th:first-child {{
    z-index: 3;
    left: 0;
}}
.cross-table td {{ font-size: 1.1rem; }}
.cross-table td:hover {{ outline: 2px solid #fff; }}
</style>
<table class="cross-table">
<thead>
<tr>
<th style="background: #222;">‚Üí deu / ‚Üì recebeu</th>
''')

    # Header row with receiver names
    for short in short_names:
        html.append(f'<th>{short}</th>')
    html.append('</tr></thead><tbody>')

    # Data rows
    for i, giver in enumerate(active_names):
        html.append(f'<tr><th>{short_names[i]}</th>')
        for j, receiver in enumerate(active_names):
            if giver == receiver:
                html.append('<td style="background: #333; color: #666;">‚Äî</td>')
            else:
                rxn = matrix[i][j] if i < len(matrix) and j < len(matrix[i]) else ""
                emoji = REACTION_EMOJI.get(rxn, '?') if rxn else '?'
                style = get_cell_style(rxn)
                tooltip = f"{giver} ‚Üí {receiver}: {rxn or 'N/A'}"
                html.append(f'<td style=\"{style}\" title=\"{tooltip}\">{emoji}</td>')
        html.append('</tr>')

    html.append('</tbody></table></div>')

    return '\n'.join(html)


def make_reaction_summary_html(summary_data, collapsed_rows=5):
    """Retorna HTML com tabela de rea√ß√µes recebidas, colaps√°vel com cores."""
    summary_rows = summary_data.get("rows", [])
    max_hearts = summary_data.get("max_hearts", 1) or 1
    max_neg = summary_data.get("max_neg", 1) or 1
    n_total = len(summary_rows)

    def heart_color(val):
        if val == 0: return "color: #666;"
        intensity = min(val / max_hearts, 1)
        if intensity > 0.7: return "background: #1a9850; color: #fff; font-weight: bold;"
        if intensity > 0.4: return "background: #91cf60; color: #000;"
        return "color: #a6d96a;"

    def neg_color(val):
        if val == 0: return "color: #666;"
        if val >= 3: return "background: #d73027; color: #fff; font-weight: bold;"
        if val >= 2: return "background: #fc8d59; color: #000;"
        return "color: #fdae61;"

    def score_color(val):
        if val >= 10: return "background: #1a9850; color: #fff; font-weight: bold;"
        if val >= 5: return "color: #66bd63;"
        if val >= 0: return "color: #a6d96a;"
        if val >= -5: return "color: #fdae61;"
        if val >= -10: return "color: #f46d43;"
        return "background: #d73027; color: #fff; font-weight: bold;"

    html = []
    html.append(f'''
<style>
.summary-table {{
    border-collapse: collapse;
    font-size: 0.85rem;
    width: 100%;
}}
.summary-table th, .summary-table td {{
    padding: 6px 8px;
    text-align: center;
    border-bottom: 1px solid #444;
}}
.summary-table th {{
    background: #222;
    position: sticky;
    top: 0;
    z-index: 1;
}}
.summary-table th:first-child, .summary-table td:first-child {{
    text-align: left;
    position: sticky;
    left: 0;
    background: #222;
    z-index: 2;
}}
.summary-table thead th:first-child {{ z-index: 3; }}
.summary-table tbody tr:hover {{ background: #333; }}
.collapsed-rows {{ display: none; }}
.expand-btn {{
    display: block;
    width: 100%;
    padding: 10px;
    margin-top: 8px;
    background: #2a2a2a;
    border: 1px solid #444;
    border-radius: 6px;
    color: #ccc;
    cursor: pointer;
    font-size: 0.9rem;
}}
.expand-btn:hover {{ background: #333; }}
</style>
<div style="overflow-x: auto; max-width: 100%;">
<table class="summary-table" id="reaction-summary-table">
<thead>
<tr>
<th>Participante</th>
<th>‚ù§Ô∏è</th>
<th>üå±</th>
<th>üíº</th>
<th>üç™</th>
<th>üêç</th>
<th>üéØ</th>
<th>ü§Æ</th>
<th>ü§•</th>
<th>üíî</th>
<th>Score</th>
</tr>
</thead>
<tbody>
''')

    for i, r in enumerate(summary_rows):
        row_class = 'collapsed-rows' if i >= collapsed_rows else ''
        html.append(f'<tr class="{row_class}">')
        html.append(f'<td>{r["name"]}</td>')
        html.append(f'<td style="{heart_color(r["hearts"])}">{r["hearts"]}</td>')
        html.append(f'<td style="{neg_color(r["planta"])}">{r["planta"] or "¬∑"}</td>')
        html.append(f'<td style="{neg_color(r["mala"])}">{r["mala"] or "¬∑"}</td>')
        html.append(f'<td style="{neg_color(r["biscoito"])}">{r["biscoito"] or "¬∑"}</td>')
        html.append(f'<td style="{neg_color(r["cobra"])}">{r["cobra"] or "¬∑"}</td>')
        html.append(f'<td style="{neg_color(r["alvo"])}">{r["alvo"] or "¬∑"}</td>')
        html.append(f'<td style="{neg_color(r["vomito"])}">{r["vomito"] or "¬∑"}</td>')
        html.append(f'<td style="{neg_color(r["mentiroso"])}">{r["mentiroso"] or "¬∑"}</td>')
        html.append(f'<td style="{neg_color(r["coracao_partido"])}">{r["coracao_partido"] or "¬∑"}</td>')
        html.append(f'<td style="{score_color(r["score"])}">{r["score"]:+.1f}</td>')
        html.append('</tr>')

    html.append('</tbody></table></div>')

    if n_total > collapsed_rows:
        html.append(f'''
<button class="expand-btn" onclick="
    var rows = document.querySelectorAll('.collapsed-rows');
    var btn = this;
    if (btn.dataset.expanded === 'true') {{
        rows.forEach(r => r.style.display = 'none');
        btn.innerHTML = '‚ñº Ver todos os {n_total} participantes';
        btn.dataset.expanded = 'false';
    }} else {{
        rows.forEach(r => r.style.display = 'table-row');
        btn.innerHTML = '‚ñ≤ Mostrar menos';
        btn.dataset.expanded = 'true';
    }}
" data-expanded="false">‚ñº Ver todos os {n_total} participantes</button>
''')

    return '\n'.join(html)


def make_negative_givers_chart(participants, matrix, title_suffix=""):
    """Retorna go.Figure com perfil de emiss√£o de rea√ß√µes (‚ù§Ô∏è vs negativos)."""
    active_ns = sorted([p['name'] for p in participants
                        if not p.get('characteristics', {}).get('eliminated')])

    giver_data = []
    for name in active_ns:
        pos_given = 0
        neg_given = 0
        for receiver in active_ns:
            if name == receiver:
                continue
            rxn = matrix.get((name, receiver), '')
            if rxn in POSITIVE:
                pos_given += 1
            elif rxn:
                neg_given += 1

        total = pos_given + neg_given
        neg_pct = (neg_given / total * 100) if total > 0 else 0

        giver_data.append({
            'Participante': name,
            '‚ù§Ô∏è dados': pos_given,
            'Negativos dados': neg_given,
            '% Negativo': round(neg_pct, 1),
            'Grupo': MEMBER_OF.get(name, '?')
        })

    df_givers = pd.DataFrame(giver_data).sort_values('% Negativo', ascending=True)

    fig = go.Figure()
    fig.add_trace(go.Bar(
        y=df_givers['Participante'],
        x=df_givers['‚ù§Ô∏è dados'],
        name='‚ù§Ô∏è dados',
        orientation='h',
        marker_color='#1a9850'
    ))
    fig.add_trace(go.Bar(
        y=df_givers['Participante'],
        x=df_givers['Negativos dados'],
        name='Negativos dados',
        orientation='h',
        marker_color='#d73027'
    ))

    title = "Perfil de Emiss√£o: Quem D√° Mais ‚ù§Ô∏è vs Negatividade?"
    if title_suffix:
        title += f" ‚Äî {title_suffix}"

    fig.update_layout(
        title=title,
        xaxis_title="Quantidade de rea√ß√µes dadas",
        yaxis_title="",
        barmode='stack',
                height=max(500, len(df_givers) * 25),
        margin=dict(l=150)
    )

    return fig
```

# Cronologia do Jogo {#cronologia-jogo}

Linha do tempo dos eventos da temporada ‚Äî pr√≥ximos eventos e hist√≥rico recente.

```{python}
#| label: timeline-events-index
#| output: asis

timeline_path = Path("data/derived/game_timeline.json")
if timeline_path.exists():
    with open(timeline_path, encoding="utf-8") as f:
        timeline_events = json.load(f).get("events", [])
    print(render_cronologia_html(timeline_events))
else:
    print("<p class='text-muted'>Nenhum evento na cronologia.</p>")
```

```{python}
#| label: compute-highlights
#| output: asis

date_display_pt = index_data.get("highlights", {}).get("date_display", "")
hl_cards = index_data.get("highlights", {}).get("cards", [])

def av(name, size=48, border_color="#555"):
    """Avatar image tag, clickable to the participant's profile."""
    url = AVATARS.get(name, "")
    slug = name.lower().replace(" ", "-")
    href = f'#perfil-{slug}'
    if url:
        img = (f'<img src="{url}" alt="{name}" title="{name}" '
               f'style="width:{size}px;height:{size}px;border-radius:50%;'
               f'object-fit:cover;border:2px solid {border_color};flex-shrink:0;">')
    else:
        img = f'<span style="display:inline-flex;align-items:center;justify-content:center;width:{size}px;height:{size}px;border-radius:50%;background:#444;color:#ccc;font-size:{size//3}px;border:2px solid {border_color};flex-shrink:0;">{name[:2]}</span>'
    return f'<a href="{href}" style="text-decoration:none;flex-shrink:0;" title="{name}">{img}</a>'

def av_pair(giver, receiver, size=36, giver_color="#888", recv_color="#888"):
    """Two avatars with arrow between them."""
    return (
        f'<span style="display:inline-flex;align-items:center;gap:4px;margin:3px 0;">'
        f'{av(giver, size, giver_color)}'
        f'<span style="color:#888;font-size:0.8em;">‚Üí</span>'
        f'{av(receiver, size, recv_color)}'
        f'</span>'
    )

def card_header(icon, title, link=None, badge=None, source_tag=None, subtitle=None):
    """Card header with icon, title, optional link, badge, data source tag, and subtitle."""
    title_html = title
    link_html = f' <a href="{link}" style="color:#888;font-size:0.7rem;text-decoration:none;vertical-align:middle;">ver mais ‚Üó</a>' if link else ""
    badge_html = f' <span style="background:rgba(255,255,255,0.15);padding:2px 8px;border-radius:10px;font-size:0.7rem;font-weight:500;">{badge}</span>' if badge else ""
    source_html = f' <span style="font-size:0.6rem;color:#888;padding:1px 6px;border:1px solid #555;border-radius:4px;vertical-align:middle;">{source_tag}</span>' if source_tag else ""
    subtitle_html = f'<div style="font-size:0.75rem;color:#999;margin-top:2px;line-height:1.3;">{subtitle}</div>' if subtitle else ""
    return (f'<div style="margin-bottom:0.6rem;">'
            f'<div style="display:flex;align-items:center;gap:0.4rem;flex-wrap:wrap;">'
            f'<span style="font-size:1.3rem;">{icon}</span>'
            f'<span style="font-weight:700;font-size:0.95rem;color:#fff;text-transform:uppercase;letter-spacing:0.03em;">{title_html}</span>'
            f'{badge_html}{source_html}{link_html}'
            f'</div>'
            f'{subtitle_html}</div>')

def stat_chip(value, label, color="#888"):
    """Small stat chip."""
    return (f'<span style="display:inline-flex;flex-direction:column;align-items:center;'
            f'background:rgba(255,255,255,0.06);padding:0.3rem 0.6rem;border-radius:8px;min-width:55px;">'
            f'<span style="font-size:1.1rem;font-weight:700;color:{color};">{value}</span>'
            f'<span style="font-size:0.65rem;color:#999;text-transform:uppercase;">{label}</span></span>')

def progress_bar(value, max_val, color="#3498db", height=6):
    """Mini progress bar."""
    pct = min(100, value / max_val * 100) if max_val > 0 else 0
    return (f'<div style="background:rgba(255,255,255,0.08);border-radius:{height//2}px;height:{height}px;width:100%;overflow:hidden;">'
            f'<div style="width:{pct:.0f}%;height:100%;background:{color};border-radius:{height//2}px;"></div></div>')


if not hl_cards:
    print(f'''<div style="background:#2a2a2a;border-radius:12px;padding:1.5rem;margin:1rem 0;text-align:center;color:#aaa;">
üìÖ Primeiro dia de dados ‚Äî sem compara√ß√µes dispon√≠veis ainda.</div>''')
else:
    # Extract context card data for the header
    ctx = next((c for c in hl_cards if c.get("type") == "context"), {})
    ctx_week = ctx.get("week", "?")
    ctx_days = ctx.get("days", 0)
    ctx_active = ctx.get("active", 0)

    # Section header with context stats
    print(f'''<div style="margin:1.5rem 0 1rem 0;">
<h2 style="margin:0 0 0.2rem 0;font-size:1.3rem;color:#fff;">üìã Destaques do Dia <span style="color:#888;font-weight:400;font-size:0.85rem;">({date_display_pt})</span></h2>
<div style="height:3px;background:linear-gradient(90deg,#f1c40f,#e74c3c,#3498db,#2ecc71);border-radius:2px;margin-bottom:0.4rem;"></div>
<div style="display:flex;gap:1.2rem;flex-wrap:wrap;font-size:0.85rem;color:#999;">
<span>üìÖ <b style="color:#ccc;">Semana {ctx_week}</b></span>
<span>{ctx_days} dias de dados</span>
<span>{ctx_active} participantes ativos</span>
</div>
</div>''')

    print('<div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(340px, 1fr));gap:0.8rem;margin-bottom:1.5rem;">')

    for card in hl_cards:
        ctype = card.get("type")
        color = card.get("color", "#555")

        # ‚îÄ‚îÄ üèÜ Ranking ‚îÄ‚îÄ
        if ctype == "ranking":
            leader = card["leader"]
            streak = card.get("streak", 1)
            streak_txt = f"{streak}¬∫ dia consecutivo" if streak > 1 else "hoje"
            podium = card.get("podium", [])
            bottom3 = card.get("bottom3", [])
            mup = card.get("movers_up")
            mdown = card.get("movers_down")

            header = card_header(
                card["icon"], card["title"], card.get("link"), streak_txt,
                source_tag="üì∏ Querid√¥metro hoje",
                subtitle="Score de hoje (‚ù§Ô∏è = +1, negativas = ‚àí0.5 a ‚àí1). Dado do dia, n√£o acumulado."
            )

            # ‚îÄ‚îÄ Top 6 (vertical list, same style as movers) ‚îÄ‚îÄ
            medals = ["ü•á", "ü•à", "ü•â", "4¬∫", "5¬∫", "6¬∫"]
            medal_borders = ["#f1c40f", "#c0c0c0", "#cd7f32", "#27ae60", "#27ae60", "#27ae60"]
            podium_html = '<div>'
            podium_html += '<div style="font-size:0.65rem;color:#888;text-transform:uppercase;letter-spacing:0.05em;margin-bottom:0.3rem;">‚¨Ü Mais queridos</div>'
            podium_html += '<div style="display:flex;flex-direction:column;gap:4px;">'
            for i, p in enumerate(podium[:6]):
                name = p["name"]
                score = p["score"]
                border = medal_borders[i] if i < len(medal_borders) else "#27ae60"
                label = medals[i] if i < len(medals) else f"{i+1}¬∫"
                podium_html += (
                    f'<div style="display:flex;align-items:center;gap:5px;background:rgba(39,174,96,0.08);padding:4px 10px;border-radius:8px;">'
                    f'{av(name, 42, border)}'
                    f'<span style="font-size:0.8rem;color:#27ae60;font-weight:700;">{label} {name.split()[0]} {score:+.1f}</span>'
                    f'</div>'
                )
            podium_html += '</div></div>'

            # ‚îÄ‚îÄ Bottom 6 (vertical list, same style as movers) ‚îÄ‚îÄ
            bottom_html = ""
            if bottom3:
                bottom_html = '<div>'
                bottom_html += '<div style="font-size:0.65rem;color:#888;text-transform:uppercase;letter-spacing:0.05em;margin-bottom:0.3rem;">‚¨á Menos queridos</div>'
                bottom_html += '<div style="display:flex;flex-direction:column;gap:4px;">'
                for p in bottom3[:6]:
                    name = p["name"]
                    score = p["score"]
                    score_color = "#e74c3c" if score < 0 else ("#f39c12" if score < 3 else "#aaa")
                    bottom_html += (
                        f'<div style="display:flex;align-items:center;gap:5px;background:rgba(231,76,60,0.08);padding:4px 10px;border-radius:8px;">'
                        f'{av(name, 42, "#e74c3c")}'
                        f'<span style="font-size:0.8rem;color:{score_color};font-weight:700;">‚¨á {name.split()[0]} {score:+.1f}</span>'
                        f'</div>'
                    )
                bottom_html += '</div></div>'

            # ‚îÄ‚îÄ Movers (compact list: up to 3 risers + 3 fallers) ‚îÄ‚îÄ
            movers_html = ""
            mup_list = mup if isinstance(mup, list) else ([mup] if mup else [])
            mdown_list = mdown if isinstance(mdown, list) else ([mdown] if mdown else [])
            if mup_list or mdown_list:
                movers_html = '<div>'
                movers_html += '<div style="font-size:0.65rem;color:#888;text-transform:uppercase;letter-spacing:0.05em;margin-bottom:0.3rem;">üìÖ Varia√ß√£o vs ontem</div>'
                movers_html += '<div style="display:flex;flex-direction:column;gap:4px;">'
                for mu in mup_list:
                    movers_html += (
                        f'<div style="display:flex;align-items:center;gap:5px;background:rgba(39,174,96,0.1);padding:4px 10px;border-radius:8px;">'
                        f'{av(mu["name"], 42, "#27ae60")}'
                        f'<span style="font-size:0.8rem;color:#27ae60;font-weight:700;">üìà {mu["name"].split()[0]} {mu["delta"]:+.1f}</span>'
                        f'</div>')
                for md in mdown_list:
                    movers_html += (
                        f'<div style="display:flex;align-items:center;gap:5px;background:rgba(231,76,60,0.1);padding:4px 10px;border-radius:8px;">'
                        f'{av(md["name"], 42, "#e74c3c")}'
                        f'<span style="font-size:0.8rem;color:#e74c3c;font-weight:700;">üìâ {md["name"].split()[0]} {md["delta"]:+.1f}</span>'
                        f'</div>')
                movers_html += '</div></div>'

            # 3-column grid on desktop, stacks on mobile
            print(f'''<div style="grid-column:1/-1;background:#2a2a2a;border-radius:12px;border-top:4px solid {color};padding:1rem 1.2rem;box-shadow:0 2px 8px rgba(0,0,0,0.3);">
{header}
<div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:0.6rem;align-items:start;">
{podium_html}
{bottom_html}
{movers_html}
</div>
</div>''')

        # ‚îÄ‚îÄ üìä Changes ‚îÄ‚îÄ
        elif ctype == "changes":
            total = card["total"]
            pct = card["pct"]
            imp = card["improve"]
            wor = card["worsen"]
            lat = card["lateral"]
            hg = card["hearts_gained"]
            hl_lost = card["hearts_lost"]
            direction_color = "#27ae60" if imp > wor else ("#e74c3c" if wor > imp else "#f39c12")

            print(f'''<div style="background:#2a2a2a;border-radius:12px;border-left:4px solid {color};padding:1rem;box-shadow:0 2px 8px rgba(0,0,0,0.3);">
{card_header(card["icon"], card["title"], card.get("link"), source_tag="üìÖ Ontem ‚Üí Hoje", subtitle="Rea√ß√µes do querid√¥metro que mudaram de ontem para hoje. Melhorias = score subiu, pioras = score caiu.")}
<div style="display:flex;align-items:baseline;gap:0.5rem;margin-bottom:0.6rem;">
<span style="font-size:2rem;font-weight:800;color:#fff;">{total}</span>
<span style="font-size:0.85rem;color:#aaa;">rea√ß√µes mudaram <span style="color:{direction_color};font-weight:600;">({pct}%)</span></span>
</div>
<div style="display:flex;gap:0.5rem;flex-wrap:wrap;margin-bottom:0.5rem;">
{stat_chip(imp, "melhorias", "#27ae60")}
{stat_chip(wor, "pioras", "#e74c3c")}
{stat_chip(lat, "laterais", "#888")}
</div>
<div style="display:flex;gap:0.6rem;font-size:0.8rem;color:#aaa;">
<span style="color:#27ae60;">+{hg} ‚ù§Ô∏è ganhados</span> <span style="color:#e74c3c;">-{hl_lost} ‚ù§Ô∏è perdidos</span>
</div>
</div>''')

        # ‚îÄ‚îÄ üí• Dramatic + ‚ö†Ô∏è Hostilities ‚Äî pair-based cards ‚îÄ‚îÄ
        elif ctype in ("dramatic", "hostilities"):
            items = card.get("items", [])
            total = card.get("total", len(items))
            is_hostile = ctype == "hostilities"
            badge = f"{total}" if total > 1 else None
            if is_hostile:
                ch = card_header(card["icon"], card["title"], card.get("link"), badge,
                    source_tag="üìÖ Ontem ‚Üí Hoje",
                    subtitle="Quem passou a dar rea√ß√£o negativa a algu√©m que ainda d√° ‚ù§Ô∏è para eles. O receptor n√£o sabe ‚Äî ponto cego."
                )
            else:
                ch = card_header(card["icon"], card["title"], card.get("link"), badge,
                    source_tag="üìÖ Ontem ‚Üí Hoje",
                    subtitle="Trocas extremas: de ‚ù§Ô∏è para negativo ou vice-versa. Quanto maior o salto, mais dram√°tica."
                )
            pairs_html = '<div style="display:flex;flex-wrap:wrap;gap:0.5rem;margin-top:0.4rem;">'
            for it in items[:4]:
                g = it["giver"]
                r = it["receiver"]
                if is_hostile:
                    emoji = it.get("emoji", "?")
                    label = f'{g.split()[0]} {emoji} {r.split()[0]}'
                    g_color = "#f39c12"
                    r_color = "#e74c3c"
                else:
                    old_e = it.get("old_emoji", "?")
                    new_e = it.get("new_emoji", "?")
                    label = f'{old_e}‚Üí{new_e}'
                    g_color = "#e74c3c" if new_e == "‚ù§Ô∏è" else "#666"
                    r_color = "#27ae60" if new_e == "‚ù§Ô∏è" else "#e74c3c"
                pairs_html += (
                    f'<div style="display:flex;align-items:center;gap:5px;background:rgba(255,255,255,0.05);'
                    f'padding:5px 8px;border-radius:8px;" title="{g} ‚Üí {r}">'
                    f'{av(g, 42, g_color)}'
                    f'<span style="font-size:0.8rem;color:#ccc;">{label}</span>'
                    f'{av(r, 42, r_color)}'
                    f'</div>'
                )
            extra = total - 4
            if extra > 0:
                link = card.get("link", "#")
                pairs_html += f'<a href="{link}" style="display:flex;align-items:center;padding:4px 10px;background:rgba(255,255,255,0.08);border-radius:8px;color:#aaa;font-size:0.75rem;text-decoration:none;">+{extra} mais ‚Üó</a>'
            pairs_html += '</div>'

            print(f'''<div style="background:#2a2a2a;border-radius:12px;border-left:4px solid {color};padding:1rem;box-shadow:0 2px 8px rgba(0,0,0,0.3);">
{ch}
{pairs_html}
</div>''')

        # ‚îÄ‚îÄ ‚ö° Sincer√£o ‚îÄ‚îÄ
        elif ctype == "sincerao":
            items = card.get("items", [])
            total = card.get("total", len(items))
            rows_html = '<div style="display:flex;flex-direction:column;gap:0.4rem;margin-top:0.3rem;">'
            for it in items[:3]:
                ator = it["ator"]
                alvo = it["alvo"]
                tipo = it.get("tipo_label", it.get("tipo", "?"))
                emoji = it.get("emoji", "?")
                rows_html += (
                    f'<div style="display:flex;align-items:center;gap:6px;background:rgba(255,255,255,0.05);padding:5px 8px;border-radius:8px;">'
                    f'{av(ator, 42, "#e67e22")}'
                    f'<span style="font-size:0.8rem;color:#ccc;">{ator.split()[0]}</span>'
                    f'<span style="font-size:0.7rem;color:#888;">disse <b style="color:#e67e22;">{tipo}</b> mas d√°</span>'
                    f'<span style="font-size:1.1rem;">{emoji}</span>'
                    f'<span style="font-size:0.7rem;color:#888;">para</span>'
                    f'{av(alvo, 42, "#27ae60")}'
                    f'<span style="font-size:0.8rem;color:#ccc;">{alvo.split()[0]}</span>'
                    f'</div>'
                )
            rows_html += '</div>'

            print(f'''<div style="background:#2a2a2a;border-radius:12px;border-left:4px solid {color};padding:1rem;box-shadow:0 2px 8px rgba(0,0,0,0.3);">
{card_header(card["icon"], card["title"], card.get("link"), f"{total}", source_tag="üì∏ Sincer√£o + Querid√¥metro", subtitle="No Sincer√£o disse negativo (bomba/n√£o ganha) mas no querid√¥metro d√° ‚ù§Ô∏è. Discurso contradiz rea√ß√£o.")}
{rows_html}
</div>''')

        # ‚îÄ‚îÄ üó≥Ô∏è Pared√£o ‚îÄ‚îÄ
        elif ctype == "paredao":
            nominees = card.get("nominees", [])
            avatars_html = '<div style="display:flex;gap:0.6rem;flex-wrap:wrap;margin-top:0.4rem;justify-content:center;">'
            for name in nominees:
                avatars_html += (
                    f'<div style="display:flex;flex-direction:column;align-items:center;">'
                    f'{av(name, 60, "#e74c3c")}'
                    f'<span style="font-size:0.7rem;color:#ccc;margin-top:3px;max-width:70px;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">{name.split()[0]}</span>'
                    f'</div>'
                )
            avatars_html += '</div>'
            print(f'''<div style="background:#2a2a2a;border-radius:12px;border-left:4px solid {color};padding:1rem;box-shadow:0 2px 8px rgba(0,0,0,0.3);">
{card_header(card["icon"], card["title"], card.get("link"), subtitle="Participantes emparedados ‚Äî clique para an√°lise de votos e rea√ß√µes.")}
{avatars_html}
</div>''')

        # ‚îÄ‚îÄ üéØ Impact ‚îÄ‚îÄ
        elif ctype == "impact":
            items = card.get("items", [])
            total = card.get("total", len(items))
            worst_neg = abs(items[0]["negative"]) if items else 1
            rows_html = '<div style="display:flex;flex-direction:column;gap:0.5rem;margin-top:0.3rem;">'
            for it in items[:4]:
                name = it["name"]
                neg = it["negative"]
                net = it["net"]
                bar_pct = min(100, abs(neg) / worst_neg * 100)
                rows_html += (
                    f'<div style="display:flex;align-items:center;gap:8px;">'
                    f'{av(name, 42, "#c0392b")}'
                    f'<div style="flex:1;min-width:0;">'
                    f'<div style="display:flex;justify-content:space-between;align-items:baseline;">'
                    f'<span style="font-size:0.8rem;font-weight:600;color:#fff;">{name.split()[0]}</span>'
                    f'<span style="font-size:0.75rem;color:#e74c3c;font-weight:700;">{neg:.1f}</span>'
                    f'</div>'
                    f'<div style="background:rgba(255,255,255,0.08);border-radius:3px;height:5px;margin-top:2px;overflow:hidden;">'
                    f'<div style="width:{bar_pct:.0f}%;height:100%;background:#e74c3c;border-radius:3px;"></div>'
                    f'</div>'
                    f'</div></div>'
                )
            extra = total - 4
            if extra > 0:
                rows_html += f'<div style="font-size:0.75rem;color:#888;text-align:center;"><a href="{card.get("link", "#")}" style="color:#aaa;text-decoration:none;">+{extra} mais ‚Üó</a></div>'
            rows_html += '</div>'
            print(f'''<div style="background:#2a2a2a;border-radius:12px;border-left:4px solid {color};padding:1rem;box-shadow:0 2px 8px rgba(0,0,0,0.3);">
{card_header(card["icon"], card["title"], card.get("link"), f"{total}", source_tag="üìà Acumulado", subtitle="Impacto negativo acumulado por eventos de poder, votos, Sincer√£o e VIP. Quem mais sofre ao longo do jogo.")}
{rows_html}
</div>''')

        # ‚îÄ‚îÄ üî¥ Vulnerability ‚îÄ‚îÄ
        elif ctype == "vulnerability":
            items = card.get("items", [])
            total = card.get("total", len(items))
            rows_html = '<div style="display:flex;flex-direction:column;gap:0.5rem;margin-top:0.3rem;">'
            for it in items[:4]:
                name = it["name"]
                count = it["count"]
                level = it.get("level", "warning")
                enemies = it.get("enemies", [])
                level_color = "#e74c3c" if level == "critical" else "#f39c12"
                level_label = "MUITO VULNER√ÅVEL" if level == "critical" else "VULNER√ÅVEL"
                enemy_avatars = ''.join(av(e, 34, level_color) for e in enemies[:4])
                extra_enemies = len(enemies) - 4
                rows_html += (
                    f'<div style="display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.04);padding:6px 8px;border-radius:8px;">'
                    f'{av(name, 42, level_color)}'
                    f'<div style="flex:1;min-width:0;">'
                    f'<div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap;">'
                    f'<span style="font-size:0.85rem;font-weight:600;color:#fff;">{name.split()[0]}</span>'
                    f'<span style="font-size:0.6rem;padding:2px 6px;border-radius:4px;background:{level_color};color:#fff;font-weight:700;">{level_label}</span>'
                    f'<span style="font-size:0.75rem;color:{level_color};font-weight:600;">{count} falsos amigos</span>'
                    f'</div>'
                    f'<div style="display:flex;gap:2px;margin-top:3px;align-items:center;">'
                    f'<span style="font-size:0.65rem;color:#888;margin-right:4px;">Quem:</span>'
                    f'{enemy_avatars}'
                    f'{f"<span style=&quot;font-size:0.65rem;color:#888;&quot;>+{extra_enemies}</span>" if extra_enemies > 0 else ""}'
                    f'</div></div></div>'
                )
            extra = total - 4
            if extra > 0:
                rows_html += f'<div style="font-size:0.75rem;color:#888;text-align:center;"><a href="{card.get("link", "#")}" style="color:#aaa;text-decoration:none;">+{extra} mais ‚Üó</a></div>'
            rows_html += '</div>'
            print(f'''<div style="background:#2a2a2a;border-radius:12px;border-left:4px solid {color};padding:1rem;box-shadow:0 2px 8px rgba(0,0,0,0.3);">
{card_header(card["icon"], card["title"], card.get("link"), f"{total}", source_tag="üìà Composto", subtitle="Falsos amigos: d√° ‚ù§Ô∏è a quem tem score negativo contra si (querid√¥metro + votos + eventos). Risco de voto surpresa.")}
{rows_html}
</div>''')

        # ‚îÄ‚îÄ üíî Streak Breaks ‚îÄ‚îÄ
        elif ctype == "breaks":
            items = card.get("items", [])
            total = card.get("total", len(items))
            strong_count = card.get("strong_count", 0)
            severity_badge = f"{strong_count} graves" if strong_count else None

            rows_html = '<div style="display:flex;flex-wrap:wrap;gap:0.5rem;margin-top:0.3rem;">'
            for it in items[:4]:
                g = it["giver"]
                r = it["receiver"]
                streak = it["streak"]
                new_e = it.get("new_emoji", "?")
                sev = it.get("severity", "mild")
                sev_border = "#e74c3c" if sev == "strong" else "#8e44ad"
                rows_html += (
                    f'<div style="display:flex;align-items:center;gap:5px;background:rgba(255,255,255,0.05);'
                    f'padding:5px 8px;border-radius:8px;border-left:3px solid {sev_border};">'
                    f'{av(g, 42, sev_border)}'
                    f'<div style="display:flex;flex-direction:column;align-items:center;">'
                    f'<span style="font-size:0.7rem;color:#aaa;">{streak}d ‚ù§Ô∏è</span>'
                    f'<span style="font-size:0.9rem;">‚Üí {new_e}</span>'
                    f'</div>'
                    f'{av(r, 42, sev_border)}'
                    f'{"<span style=&quot;font-size:0.7rem;color:#e74c3c;font-weight:700;&quot;>üö®</span>" if sev == "strong" else ""}'
                    f'</div>'
                )
            extra = total - 4
            if extra > 0:
                rows_html += f'<a href="{card.get("link", "#")}" style="display:flex;align-items:center;padding:5px 10px;background:rgba(255,255,255,0.06);border-radius:8px;color:#aaa;font-size:0.75rem;text-decoration:none;">+{extra} mais ‚Üó</a>'
            rows_html += '</div>'

            print(f'''<div style="background:#2a2a2a;border-radius:12px;border-left:4px solid {color};padding:1rem;box-shadow:0 2px 8px rgba(0,0,0,0.3);">
{card_header(card["icon"], card["title"], card.get("link"), severity_badge or f"{total}", source_tag="üìà Hist√≥rico", subtitle="Alian√ßas longas de ‚ù§Ô∏è que foram rompidas. Quanto mais dias seguidos, mais grave a ruptura.")}
{rows_html}
</div>''')

        # ‚îÄ‚îÄ üß≠ Strategic divergence ‚îÄ‚îÄ
        elif ctype == "strategic":
            podium = card.get("podium", [])
            leader = card.get("leader", "?")
            strat_html = '<div style="display:flex;gap:0.5rem;align-items:center;margin-top:0.3rem;flex-wrap:wrap;">'
            for i, p in enumerate(podium[:3]):
                medals = ["ü•á", "ü•à", "ü•â"]
                strat_html += (
                    f'<div style="display:flex;align-items:center;gap:5px;background:rgba(255,255,255,0.05);padding:4px 8px;border-radius:8px;">'
                    f'{av(p["name"], 42, "#9b59b6")}'
                    f'<span style="font-size:0.8rem;color:#ccc;">{medals[i]} {p["name"].split()[0]}</span>'
                    f'<span style="font-size:0.8rem;color:#9b59b6;font-weight:700;">{p["score"]:+.2f}</span>'
                    f'</div>'
                )
            strat_html += '</div>'
            print(f'''<div style="background:#2a2a2a;border-radius:12px;border-left:4px solid {color};padding:1rem;box-shadow:0 2px 8px rgba(0,0,0,0.3);">
{card_header(card["icon"], card["title"], card.get("link"), source_tag="üìà Composto", subtitle="Score m√©dio recebido (querid√¥metro + votos + eventos). L√≠der diverge do ranking puro por emoji.")}
{strat_html}
</div>''')

        # ‚îÄ‚îÄ üìÖ Context ‚Äî rendered in the header, not as a card ‚îÄ‚îÄ
        elif ctype == "context":
            pass  # handled above in section header

    print('</div>')  # close grid
```

```{python}
#| label: paredao-status-card
#| output: asis

paredao_names = index_data.get("paredao", {}).get("names", [])
if paredao_names:
    status_text = "Em Vota√ß√£o"
    status_color = "#e74c3c"
    status_icon = "üó≥Ô∏è"
    names_display = ", ".join(sorted(paredao_names))
    detail_html = f'<div style="color: #ccc; font-size: 0.95rem;">Emparedados: <strong>{names_display}</strong></div>'
else:
    status_text = "Aguardando forma√ß√£o"
    status_color = "#6c757d"
    status_icon = "‚è≥"
    detail_html = '<div style="color: #888; font-size: 0.9rem;">Nenhum pared√£o ativo no momento</div>'

print(f'''
<div style="background: #2a2a2a; border-radius: 12px; padding: 1rem 1.2rem; margin: 1rem 0 1.5rem 0; border-left: 4px solid {status_color}; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
<div>
<div style="font-size: 1.1rem; font-weight: bold; color: #fff; margin-bottom: 0.3rem;">
{status_icon} Pared√£o: <span style="color: {status_color};">{status_text}</span>
</div>
{detail_html}
<div style="font-size: 0.85rem; color: #999; margin-top: 0.4rem;">
<a href="paredao.html" style="color:#3498db;">Pared√£o atual</a> ¬∑ <a href="paredoes.html" style="color:#3498db;">Arquivo de pared√µes</a>
</div>
</div>
<a href="paredao.html" style="background: {status_color}; color: #fff; padding: 0.5rem 1rem; border-radius: 6px; text-decoration: none; font-weight: 500; font-size: 0.9rem; white-space: nowrap;">
Ver an√°lise ‚Üí
</a>
</div>
''')
```

# Rankings {#ranking-sentimento}

```{python}
#| label: composite-score-desc
#| output: asis
print(ANALYSIS_DESCRIPTIONS["composite_score_chart"])
```

```{python}
#| label: ranking-prep
#| include: false

ranking_data = index_data.get("ranking", {})
_ranking_height = ranking_data.get("height", 500)
today_rows = ranking_data.get("today", [])
strategic_rows = ranking_data.get("strategic", [])
```

::: {.panel-tabset}

## Querid√¥metro

```{python}
#| label: sentiment-ranking-today

fig = make_sentiment_ranking(today_rows, title_suffix=latest.get("label", ""), fixed_height=_ranking_height)
fig.show()
```

## Estrat√©gico

```{python}
#| label: strategic-ranking
#| output: asis

if strategic_rows:
    df_strat = pd.DataFrame(strategic_rows).sort_values('score', ascending=True)

    # Build querid√¥metro rank lookup for divergence display
    quer_sorted = sorted(today_rows, key=lambda x: -x['score'])
    quer_rank = {r['name']: i+1 for i, r in enumerate(quer_sorted)}
    strat_sorted = sorted(strategic_rows, key=lambda x: -x['score'])
    strat_rank = {r['name']: i+1 for i, r in enumerate(strat_sorted)}

    fig_s = go.Figure()
    fig_s.add_trace(go.Bar(
        y=df_strat['name'],
        x=df_strat['score'],
        orientation='h',
        marker_color=[GROUP_COLORS.get(g, '#999') for g in df_strat['group']],
        text=[f"{s:+.2f}" for s in df_strat['score']],
        textposition='outside',
        hovertemplate='%{y}: %{x:+.2f}<br>Querid√¥metro: %{customdata[0]:+.1f} (#%{customdata[1]})<br>Estrat√©gico: #%{customdata[2]}<extra></extra>',
        customdata=list(zip(
            df_strat['queridometro_score'],
            [quer_rank.get(n, '?') for n in df_strat['name']],
            [strat_rank.get(n, '?') for n in df_strat['name']],
        )),
        showlegend=False
    ))

    title_s = "Ranking Estrat√©gico"
    if latest.get("label"):
        title_s += f" ‚Äî {latest['label']}"

    fig_s.update_layout(
        title=title_s,
        xaxis_title="Score Composto (m√©dia recebida)",
        yaxis_title="",
        height=_ranking_height,
        margin=dict(l=150),
        shapes=[dict(type='line', x0=0, x1=0, y0=-0.5, y1=len(df_strat)-0.5,
                     line=dict(color='red', dash='dash', width=1))]
    )

    for group, color in GROUP_COLORS.items():
        fig_s.add_trace(go.Scatter(
            x=[None], y=[None], mode='markers',
            marker=dict(size=10, color=color),
            name=group, showlegend=True
        ))

    fig_s.show()

    # Show divergence table
    divergences = []
    for r in strategic_rows:
        name = r['name']
        qr = quer_rank.get(name, 99)
        sr = strat_rank.get(name, 99)
        delta = qr - sr
        if abs(delta) >= 3:
            divergences.append((name, qr, sr, delta, r['score'], r['queridometro_score']))

    if divergences:
        divergences.sort(key=lambda x: -abs(x[3]))
        print("<details><summary><strong>Maiores diverg√™ncias entre rankings</strong> (‚â•3 posi√ß√µes)</summary>")
        print("<div style='margin-top: 0.5rem; font-size: 0.85rem;'>")
        for name, qr, sr, delta, cs, qs in divergences:
            if delta > 0:
                icon = "üìà"
                desc = f"sobe {delta} posi√ß√µes"
                color = "#27ae60"
            else:
                icon = "üìâ"
                desc = f"cai {abs(delta)} posi√ß√µes"
                color = "#e74c3c"
            print(f"<div style='padding: 0.3rem 0; border-bottom: 1px solid #333;'>"
                  f"{icon} <strong>{name}</strong>: Querid√¥metro #{qr} ({qs:+.1f}) ‚Üí "
                  f"Estrat√©gico #{sr} ({cs:+.2f}) ‚Äî "
                  f"<span style='color: {color};'>{desc}</span></div>")
        print("</div></details>")
else:
    print("<p class='text-muted'>Dados de rela√ß√µes n√£o dispon√≠veis.</p>")
```

## Evolu√ß√£o

```{python}
#| label: evolution-shared
#| include: false

# Shared setup for evolution charts
_paredoes_markers = []
_paredoes_file = Path("data/paredoes.json")
if _paredoes_file.exists():
    with open(_paredoes_file, encoding="utf-8") as f:
        _paredoes_json = json.load(f)
    for _p in _paredoes_json.get('paredoes', []):
        _paredoes_markers.append({
            'date': pd.to_datetime(_p['data']),
            'label': f"üó≥Ô∏è {_p['numero']}¬∫ Pared√£o",
        })

# Consistent color palette across both charts
_all_participants = sorted(set(
    row["name"] for row in index_data.get("timeline", [])
))
_palette = (
    px.colors.qualitative.Plotly + px.colors.qualitative.D3 +
    px.colors.qualitative.Set2 + px.colors.qualitative.Bold
)
_part_colors = {name: _palette[i % len(_palette)] for i, name in enumerate(_all_participants)}


def make_evolution_chart(data_rows, score_key, title, y_label, score_fmt="+.1f"):
    """Build an evolution chart with rank annotations and pared√£o markers."""
    if not data_rows:
        return None

    df = pd.DataFrame([{
        "Data": pd.to_datetime(row["date"]),
        "Participante": row["name"],
        "Score": row[score_key],
        "Grupo": row.get("group", "?"),
        "Rank": row.get("rank"),
    } for row in data_rows])

    if df.empty or len(df['Data'].unique()) < 2:
        return None

    all_parts = sorted(df['Participante'].unique())

    # Find biggest movers: participants with largest score change from first to last appearance
    first_scores = df.sort_values('Data').groupby('Participante')['Score'].first()
    last_scores = df.sort_values('Data').groupby('Participante')['Score'].last()
    deltas = (last_scores - first_scores).dropna()

    top5 = set(last_scores.nlargest(5).index)
    bottom5 = set(last_scores.nsmallest(5).index)
    movers = set(deltas.abs().nlargest(5).index)
    highlight = top5 | bottom5

    fig = go.Figure()

    for name in all_parts:
        df_p = df[df['Participante'] == name].sort_values('Data')
        is_hl = name in highlight
        is_mover = name in movers

        # Use precomputed rank from data
        ranks = df_p['Rank'].tolist() if 'Rank' in df_p.columns else [None] * len(df_p)

        hover_text = [
            f"{name}: {s:{score_fmt}} (#{r})" if r else f"{name}: {s:{score_fmt}}"
            for s, r in zip(df_p['Score'], ranks)
        ]

        fig.add_trace(go.Scatter(
            x=df_p['Data'], y=df_p['Score'],
            mode='lines+markers',
            name=f"{'üìà ' if is_mover and name in movers - highlight else ''}{name}",
            line=dict(
                width=3 if is_hl else 1.5,
                color=_part_colors.get(name, '#999'),
            ),
            marker=dict(size=6 if is_hl else 3),
            hovertext=hover_text,
            hoverinfo='text',
            visible=True if is_hl else 'legendonly',
        ))

    # Rank annotations at last date for visible traces
    last_date = df['Data'].max()
    last_df = df[df['Data'] == last_date].copy()
    if 'Rank' not in last_df.columns or last_df['Rank'].isna().all():
        last_df['Rank'] = last_df['Score'].rank(ascending=False, method='min').astype(int)
    for _, row in last_df.iterrows():
        if row['Participante'] in highlight:
            fig.add_annotation(
                x=last_date, y=row['Score'],
                text=f"#{int(row['Rank'])}",
                showarrow=False,
                font=dict(size=9, color='#aaa'),
                xshift=28,
            )

    # Zero line
    fig.add_shape(type='line',
                  x0=df['Data'].min(), x1=df['Data'].max(),
                  y0=0, y1=0,
                  line=dict(color='red', dash='dash', width=1))

    # Pared√£o markers
    y_min = df['Score'].min()
    y_max = df['Score'].max()
    y_range = [y_min - abs(y_max - y_min) * 0.1, y_max + abs(y_max - y_min) * 0.1]
    for marker in _paredoes_markers:
        if df['Data'].min() <= marker['date'] <= df['Data'].max():
            fig.add_shape(
                type='line', x0=marker['date'], x1=marker['date'],
                y0=y_range[0], y1=y_range[1],
                line=dict(color='#FF6B6B', dash='dot', width=1.5),
            )
            fig.add_annotation(
                x=marker['date'], y=y_range[1],
                text=marker['label'],
                showarrow=False,
                font=dict(size=10, color='#FF6B6B'),
                yshift=10,
            )

    fig.update_layout(
        title=title,
        xaxis_title="Data",
        yaxis_title=y_label,
        height=max(550, len(all_parts) * 20),
        hovermode='x',
        legend=dict(
            font=dict(size=10),
            itemsizing='constant',
            bgcolor='rgba(0,0,0,0.5)',
        ),
        margin=dict(r=200),
    )

    # Add updatemenus for quick presets
    n_traces = len(all_parts)
    fig.update_layout(
        updatemenus=[dict(
            type='buttons',
            direction='right',
            x=0.0, y=1.12,
            xanchor='left', yanchor='top',
            bgcolor='rgba(50,50,50,0.8)',
            font=dict(color='#ccc', size=10),
            buttons=[
                dict(label='Top 5 + Bottom 5',
                     method='update',
                     args=[{'visible': [
                         True if name in highlight else 'legendonly'
                         for name in all_parts
                     ] + [True] * (len(fig.data) - n_traces)}]),
                dict(label='Maiores Mudan√ßas',
                     method='update',
                     args=[{'visible': [
                         True if name in movers else 'legendonly'
                         for name in all_parts
                     ] + [True] * (len(fig.data) - n_traces)}]),
                dict(label='Todos',
                     method='update',
                     args=[{'visible': [True] * len(fig.data)}]),
            ],
        )]
    )

    return fig
```

::: {.panel-tabset}

### Querid√¥metro

```{python}
#| label: evolution-queridometro
#| output: asis

timeline_data = index_data.get("timeline", [])
fig_evo_q = make_evolution_chart(
    timeline_data, "sentiment",
    title="Evolu√ß√£o do Querid√¥metro",
    y_label="Score de Sentimento (soma rea√ß√µes)",
    score_fmt="+.1f",
)
if fig_evo_q:
    fig_evo_q.show()
    print("<p class='text-muted small' style='margin-top: 0.3rem;'>Score = soma ponderada de rea√ß√µes recebidas (‚ù§Ô∏è +1, leves ‚àí0.5, fortes ‚àí1). Use os bot√µes acima para alternar entre presets.</p>")
else:
    print("<p class='text-muted'>Dados insuficientes para gr√°fico de evolu√ß√£o.</p>")
```

### Estrat√©gico

```{python}
#| label: evolution-strategic
#| output: asis

strat_timeline_data = index_data.get("strategic_timeline", [])
fig_evo_s = make_evolution_chart(
    strat_timeline_data, "score",
    title="Evolu√ß√£o do Score Estrat√©gico",
    y_label="Score Composto (m√©dia recebida)",
    score_fmt="+.3f",
)
if fig_evo_s:
    fig_evo_s.show()
    print(f"<p class='text-muted small' style='margin-top: 0.3rem;'>{ANALYSIS_DESCRIPTIONS['strategic_evolution_caption']}</p>")
else:
    print("<p class='text-muted'>Dados de rela√ß√µes n√£o dispon√≠veis para evolu√ß√£o estrat√©gica.</p>")
```

:::

:::

# Tabela Cruzada de Rea√ß√µes {#crosstable}

<p class="text-muted small">üì∏ <strong>Dado do dia</strong> ‚Äî mostra apenas a coleta mais recente.</p>

Quem deu qual rea√ß√£o para quem. Cada c√©lula mostra a rea√ß√£o que a **linha** (emissor) deu para a **coluna** (receptor).

```{python}
#| label: cross-table
#| output: asis

cross_data = index_data.get("cross_table", {})
print(make_cross_table_html(cross_data, title_suffix=latest.get("label", "")))
```

```{python}
#| label: cross-table-summary
#| output: asis

print("\n### Rea√ß√µes Recebidas por Participante\n")
print("<p class='text-muted small'>Ordenado por score de sentimento. C√©lulas coloridas indicam valores altos.</p>")
summary_data = index_data.get("reaction_summary", {})
print(make_reaction_summary_html(summary_data, collapsed_rows=5))
```

# Perfis Individuais {#perfis}

```{python}
#| label: profiles-intro-desc
#| output: asis
print(ANALYSIS_DESCRIPTIONS["profiles_intro"])
```

<details style="margin: 1.5rem 0;">
<summary style="cursor: pointer; color: #fff; font-weight: 600; background: #2a2a2a; border-radius: 12px; padding: 0.9rem 1.2rem; border-left: 4px solid #17a2b8;">
‚ÑπÔ∏è Como calculamos Vulnerabilidade, Impacto Negativo e Hostilidade Gerada (clique para expandir)
</summary>
<div style="background: #2a2a2a; border-radius: 12px; padding: 1.2rem; margin-top: 0.8rem; border-left: 4px solid #17a2b8;">

**üéØ Vulnerabilidade a Votos Surpresa**

```{python}
#| label: vulnerability-desc
#| output: asis
print(ANALYSIS_DESCRIPTIONS["vulnerability_long"])
```

| Badge | Crit√©rio | Significado |
|-------|----------|-------------|
| üî¥ **MUITO VULNER√ÅVEL** | 5+ falsos amigos | Posi√ß√£o cr√≠tica. Muitas pessoas que considera amigas podem votar contra sem que espere. |
| üü† **VULNER√ÅVEL** | 3-4 falsos amigos | Posi√ß√£o fr√°gil. Alguns "amigos" s√£o hostis e podem surpreender em vota√ß√£o. |
| üü° **ATEN√á√ÉO** | 1-2 falsos amigos | Posi√ß√£o razo√°vel, mas com pontos cegos. |
| üü¢ **PROTEGIDO** | 0 falsos amigos | Sem pontos cegos ‚Äî sabe quem s√£o seus aliados e inimigos. |

**üß≠ Impacto Negativo (acumulado)**

Mede o quanto o participante foi alvo de eventos negativos ao longo do jogo: indica√ß√µes, contragolpes, votos recebidos, Sincer√£o negativo, visibilidade de votos, e backlash. Usa os mesmos pesos calibrados do sistema de rela√ß√µes (`relations_scores.json` ‚Üí `received_impact.negative`), sem decay ‚Äî todos os eventos acumulam com peso integral.

Faixas: üü¢ **NENHUM** (0), üü° **BAIXO** (< 0), üü† **M√âDIO** (‚â§ -5), üî¥ **ALTO** (‚â§ -10).

**üî• Hostilidade Gerada (acumulada)**

Mede o quanto o participante **causou impacto negativo** sobre os demais: soma das edges negativas de eventos de poder, votos, Sincer√£o e visibilidade. Usa os mesmos pesos calibrados do sistema de rela√ß√µes (`pairs_daily` ‚Üí componentes n√£o-querid√¥metro), sem decay.

Faixas: üü¢ **NENHUMA** (0), üü° **BAIXA** (< 0), üü† **M√âDIA** (‚â§ -4), üî¥ **ALTA** (‚â§ -8).

**Categorias de Rela√ß√£o** (baseadas no score composto, n√£o apenas emoji):

- **‚úÖ Aliados** ‚Äî Score positivo m√∫tuo. Nos 2 pared√µes, 0% dos aliados votaram contra. Votos seguros.
- **‚öîÔ∏è Inimigos** ‚Äî Score negativo m√∫tuo. Votos contra esperados de ambos os lados.
- **‚ö†Ô∏è Falsos Amigos** ‚Äî Seu score √© positivo (confia), mas o deles √© negativo (hostil). **PERIGO:** votam contra 2-3√ó mais que n√£o-falsos amigos.
- **üó°Ô∏è Alvos Ocultos** ‚Äî Seu score √© negativo (hostil), mas eles confiam em voc√™. Eles n√£o sabem que s√£o seus alvos.

```{python}
#| label: profiles-footer-desc
#| output: asis
print(ANALYSIS_DESCRIPTIONS["profiles_footer"])
```

**Sinais de jogo no perfil:**
- **Poderes recebidos** (benef√≠cios e preju√≠zos): acontecimentos na casa que afetam o score.
- **Votos da casa recebidos**: marcados com dedo-duro quando o voto foi revelado.
- **Impacto Negativo** e **Hostilidade Gerada**: pesos calibrados do sistema de rela√ß√µes (sem diverg√™ncia).

</div>
</details>

```{python}
#| label: individual-profiles
#| output: asis

profiles = index_data.get("profiles", [])

source_icons = {
    'big fone': 'üìû',
    'caixas-surpresa': 'üéÅ',
    'prova do l√≠der': 'üëë',
    'prova do anjo': 'üòá',
    'castigo do monstro': 'üëπ',
    'din√¢mica da casa': 'üé¨',
}

print("""
<style>
/* ‚ïê‚ïê‚ïê Profile Card ‚ïê‚ïê‚ïê */
.profile-card {
    background: #2a2a2a;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    margin-bottom: 1.5rem;
}

/* Hero header */
.profile-hero-inner {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
}
.profile-hero-inner .stat-row {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
    position: relative;
    margin-top: 0.4rem;
    align-items: center;
}

/* Status strip */
.profile-status-strip {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    padding: 0.6rem 1rem;
    border-bottom: 1px solid #444;
    background: #333;
}

/* Status detail (tappable <details>) */
.status-detail {
    flex: 1;
    min-width: 140px;
}
.status-detail summary {
    cursor: pointer;
    list-style: none;
    display: flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.4rem 0.8rem;
    border-radius: 8px;
}
.status-detail summary::-webkit-details-marker { display: none; }
.status-detail[open] .status-breakdown {
    padding: 0.5rem 0.8rem;
    font-size: 0.75rem;
}
.status-breakdown .sb-row {
    display: flex;
    justify-content: space-between;
    gap: 0.6rem;
    padding: 0.15rem 0;
    border-bottom: 1px solid #333;
}
.status-breakdown .sb-row:last-child { border-bottom: none; }
.status-breakdown .sb-muted { color: #999; font-size: 0.7rem; margin-top: 0.3rem; }

/* Reactions grid */
.profile-reactions-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.8rem;
    padding: 0.8rem 1rem;
    border-bottom: 1px solid #444;
    background: #333;
}
.rxn-chip {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    background: #2f2f2f;
    padding: 0.2rem 0.5rem;
    border-radius: 8px;
    font-size: 0.8rem;
    color: #ddd;
}

.rxn-detail summary::-webkit-details-marker { display: none; }
.stat-row details { position: relative; display: inline; margin: 0; padding: 0; }
.stat-row details > summary.rxn-chip {
    list-style: none;
    margin: 0;
    padding: 0.2rem 0.5rem;
    font-size: 0.8rem;
    line-height: 1.4;
}
.stat-row details > summary.rxn-chip::-webkit-details-marker { display: none; }
.stat-row details > summary.rxn-chip::marker { display: none; content: ""; }
.stat-row .rxn-chip { line-height: 1.4; font-size: 0.8rem; }
.rxn-detail[open] summary .rxn-hint { display: none; }

/* Relations grid */
.profile-relations {
    padding: 0.8rem 1rem;
    border-bottom: 1px solid #444;
}
.relation-section {
    margin-bottom: 0.6rem;
    padding: 0.5rem;
    border-radius: 6px;
}
.relation-section:last-child { margin-bottom: 0; }
.relation-label {
    font-weight: 700;
    font-size: 0.8rem;
    margin-bottom: 0.35rem;
}
.avatar-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: flex-start;
}

/* Game dynamics (collapsible) */
.game-dynamics-detail summary {
    cursor: pointer;
    font-weight: 700;
    color: #fff;
    font-size: 0.9rem;
    padding: 0.6rem 0;
    list-style: none;
}
.game-dynamics-detail summary::-webkit-details-marker { display: none; }
.game-dynamics-detail summary::before {
    content: '‚ñ∂ ';
    font-size: 0.7rem;
    color: #888;
}
.game-dynamics-detail[open] summary::before {
    content: '‚ñº ';
}

/* Curiosities */
.curiosity-item {
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
    padding: 0.3rem 0;
    font-size: 0.82rem;
    color: #ccc;
}
.curiosity-icon { font-size: 1rem; flex-shrink: 0; }

/* Mobile responsive */
@media (max-width: 600px) {
    .profile-hero-inner {
        flex-direction: column;
        text-align: center;
    }
    .profile-hero-inner .stat-row {
        justify-content: center;
    }
    .profile-status-strip {
        flex-direction: column;
    }
    .profile-status-strip .status-detail {
        min-width: 100%;
    }
    .profile-reactions-grid {
        grid-template-columns: 1fr !important;
    }
}
</style>
""")

def plant_color(score):
    if score >= 80:
        return "#2f7d46"
    if score >= 60:
        return "#6c8a3c"
    if score >= 40:
        return "#b9772a"
    return "#a94442"

def render_actor_avatars(actors, border_color="#666", color_lookup=None, size=24, skip_icons=None):
    if not actors:
        return ''
    parts = []
    for a in actors:
        color = border_color
        if color_lookup and a in color_lookup:
            color = color_lookup[a]
        if a in AVATARS and AVATARS[a]:
            parts.append(
                f'<img src="{AVATARS[a]}" style="width:{size}px;height:{size}px;border-radius:50%;'
                f'border:1.5px solid {color};object-fit:cover;margin-right:-3px;">'
            )
        else:
            icon = None
            lower = a.lower() if isinstance(a, str) else ''
            for k, v in source_icons.items():
                if k in lower:
                    icon = v
                    break
            if "din√¢mica da casa" in lower:
                continue
            if icon and skip_icons and icon in skip_icons:
                continue
            parts.append(f'<span style="font-size: 0.9rem;">{icon or "üé¨"}</span>')
    return ''.join(parts)


def make_event_chips(events, border_color, color_lookup=None):
    if not events:
        return "<span style='color:#777;'>‚Äî</span>"
    chips = []
    for ev in events:
        emoji = ev.get("emoji", "‚Ä¢")
        label = ev.get("label", ev.get("type"))
        count = ev.get("count", 1)
        actors = ev.get("actors", [])
        count_prefix = f"{count}x " if count > 1 else ""
        chip_border = border_color
        actor_html = render_actor_avatars(
            actors,
            chip_border,
            color_lookup=color_lookup,
            size=20,
            skip_icons={emoji} if emoji else None,
        )
        actor_label = " + ".join(actors) if actors else ""
        title = f"{label} ‚Äî {actor_label}" if actor_label else label
        chips.append(
            f"<span style='display:inline-flex; align-items:center; gap:0.25rem; background:#2f2f2f; "
            f"border:1px solid {chip_border}; color:#ddd; border-radius:8px; padding:0.2rem 0.5rem; "
            f"font-size:0.8rem; margin:0.1rem; line-height:1.4;' title='{title}'>"
            f"{count_prefix}{emoji} {label} {actor_html}</span>"
        )
    return ' '.join(chips)


def render_status_chip(emoji, label, level, color, detail_html=""):
    """Tappable status indicator with optional breakdown."""
    r, g, b = int(color[1:3], 16), int(color[3:5], 16), int(color[5:7], 16)
    bg = f"rgba({r},{g},{b},0.12)"
    if detail_html:
        return (
            f'<details class="status-detail">'
            f'<summary style="background:{bg};border-left:3px solid {color};">'
            f'<span style="font-size:1rem;">{emoji}</span>'
            f'<div><div style="font-size:0.75rem;font-weight:700;color:{color};">{level}</div>'
            f'<div style="font-size:0.65rem;color:#999;">{label}</div></div>'
            f'</summary>'
            f'<div class="status-breakdown" style="color:#aaa;">{detail_html}</div>'
            f'</details>'
        )
    return (
        f'<div style="display:flex;align-items:center;gap:0.4rem;background:{bg};'
        f'padding:0.4rem 0.8rem;border-radius:8px;border-left:3px solid {color};flex:1;min-width:140px;">'
        f'<span style="font-size:1rem;">{emoji}</span>'
        f'<div><div style="font-size:0.75rem;font-weight:700;color:{color};">{level}</div>'
        f'<div style="font-size:0.65rem;color:#999;">{label}</div></div>'
        f'</div>'
    )

def render_avatar_row(items, border_color, max_show=999):
    """Row of avatars with name + score under each. Shows ALL by default."""
    if not items:
        return '<span style="color:#777;font-size:0.8rem;">‚Äî</span>'
    html = '<div class="avatar-row">'
    for item in items:
        if isinstance(item, str):
            n = item
            score_html = ""
        else:
            n = item.get("name", "")
            # Show "their_score" (what they think of me) as the primary displayed score
            ts = item.get("their_score")
            ms = item.get("my_score")
            if ts is not None:
                sc_color = "#28a745" if ts >= 0 else "#dc3545"
                score_html = f'<div style="font-size:0.65rem;color:{sc_color};font-weight:600;">{ts:+.1f}</div>'
            elif ms is not None:
                sc_color = "#28a745" if ms >= 0 else "#dc3545"
                score_html = f'<div style="font-size:0.65rem;color:{sc_color};font-weight:600;">{ms:+.1f}</div>'
            else:
                score_html = ""
        first_name = n.split()[0] if n else ""
        html += (
            f'<div style="display:flex;flex-direction:column;align-items:center;width:60px;">'
            f'{av(n, 48, border_color)}'
            f'<div style="font-size:0.65rem;color:#bbb;margin-top:2px;text-align:center;'
            f'white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:60px;">{first_name}</div>'
            f'{score_html}'
            f'</div>'
        )
    html += '</div>'
    return html


for p in profiles:
    name = p.get('name')
    member_of = p.get('member_of', '?')
    group = p.get('group', '?')
    balance = p.get('balance', 0)
    roles = p.get('roles', [])
    score = p.get('score', 0)

    rxn_summary = " | ".join([f"{r['emoji']}√ó{r['count']}" for r in p.get('rxn_summary', [])])
    given_summary = " | ".join([f"{r['emoji']}√ó{r['count']}" for r in p.get('given_summary', [])])

    rel = p.get("relations", {})
    allies = rel.get("allies", [])
    enemies = rel.get("enemies", [])
    false_friends = rel.get("false_friends", [])
    blind_targets = rel.get("blind_targets", [])

    n_allies = len(allies)
    n_enemies = len(enemies)
    n_false_friends = len(false_friends)

    ally_names = {a["name"] for a in allies}
    enemy_names = {n["name"] for n in enemies}
    false_friend_names = {n["name"] for n in false_friends}
    blind_names = {n["name"] for n in blind_targets}

    relation_colors = {}
    relation_colors.update({n: "#28a745" for n in ally_names})
    relation_colors.update({n: "#dc3545" for n in enemy_names})
    relation_colors.update({n: "#ffc107" for n in false_friend_names})
    relation_colors.update({n: "#6f42c1" for n in blind_names})

    events = p.get("events", {})
    pos_html = make_event_chips(events.get("pos_week", []), "#28a745", relation_colors)
    neg_html = make_event_chips(events.get("neg_week", []), "#dc3545", relation_colors)
    pos_hist_html = make_event_chips(events.get("pos_hist", []), "#2ecc71", relation_colors) if events.get("pos_hist") else ""
    neg_hist_html = make_event_chips(events.get("neg_hist", []), "#e74c3c", relation_colors) if events.get("neg_hist") else ""
    hist_html = ""
    if events.get("pos_hist"):
        hist_html += f"<span style='color:#28a745;'>{pos_hist_html}</span>"
    if events.get("neg_hist"):
        hist_html += f"<span style='color:#dc3545; margin-left:0.35rem;'>{neg_hist_html}</span>"

    votes = p.get("votes_received", [])
    if votes:
        vote_rows = []
        for v in votes:
            voter = v.get("voter")
            count = v.get("count", 1)
            is_revealed = v.get("revealed", False)
            count_badge = f'<span style="background:#555;color:#fff;border-radius:50%;font-size:0.65rem;padding:1px 5px;margin-left:0.3rem;">{count}√ó</span>' if count > 1 else ""
            border = relation_colors.get(voter, "#666")
            reveal_badge = ' <span style="color:#17a2b8;font-size:0.75rem;">üëÅÔ∏è</span>' if is_revealed else ""
            voter_avatar = av(voter, 36, border) if voter in AVATARS else ""
            voter_first = voter.split()[0] if voter else ""
            vote_rows.append(
                f"<div style='display:flex;align-items:center;gap:0.5rem;background:rgba(255,255,255,0.05);"
                f"padding:0.3rem 0.6rem;border-radius:8px;margin:0.15rem 0;'>"
                f"{voter_avatar}"
                f"<span style='font-size:0.82rem;color:#ddd;'>{voter_first}</span>"
                f"{count_badge}{reveal_badge}</div>"
            )
        votes_html = ''.join(vote_rows)
    else:
        votes_html = ""

    sinc = p.get("sincerao", {})
    chips = []
    for reason in sinc.get("reasons", []):
        chips.append(
            f"<span style='display:inline-flex; align-items:center; gap:0.3rem; background:#2f2f2f; "
            f"border:1px solid #17a2b8; color:#ddd; border-radius:10px; padding:0.18rem 0.5rem; "
            f"font-size:0.72rem; margin:0.15rem;'>{reason}</span>"
        )
    for tema, count in (sinc.get("bombas", {}) or {}).items():
        prefix = f"{count}x " if count > 1 else ""
        chips.append(
            f"<span style='display:inline-flex; align-items:center; gap:0.3rem; background:#2f2f2f; "
            f"border:1px solid #17a2b8; color:#ddd; border-radius:10px; padding:0.18rem 0.5rem; "
            f"font-size:0.72rem; margin:0.15rem;'>üí£ {prefix}{tema}</span>"
        )
    sincerao_html = " ".join(chips) if chips else ""

    sinc_contra = p.get("sinc_contra", {})
    sinc_contra_count = sinc_contra.get("count", 0)

    risk_level = p.get("risk_level")
    risk_color = p.get("risk_color")
    external_level = p.get("external_level")
    external_color = p.get("external_color")
    animosity_level = p.get("animosity_level")
    animosity_color = p.get("animosity_color")
    scores_data = p.get("scores", {})

    # Component labels for breakdown
    COMP_LABELS = {
        "power_event": "Eventos de poder",
        "sincerao": "Sincer√£o",
        "vote": "Votos",
        "vip": "VIP",
        "anjo": "Anjo",
        "visibility": "Visibilidade",
    }

    avatar_url = AVATARS.get(name, '')
    cor_grupo = GROUP_COLORS.get(member_of, '#666')
    name_slug = name.lower().replace(" ", "-")
    role_text = ", ".join(roles) if roles else ""
    score_color = '#28a745' if score >= 0 else '#dc3545'

    # ‚ïê‚ïê‚ïê [1] HERO HEADER ‚ïê‚ïê‚ïê
    avatar_img = (
        f'<img src="{avatar_url}" alt="{name}" '
        f'style="width:88px;height:88px;border-radius:50%;object-fit:cover;'
        f'border:3px solid {cor_grupo};flex-shrink:0;">'
    ) if avatar_url else ""

    group_pill = (
        f'<span style="display:inline-block;background:{cor_grupo};color:#fff;'
        f'padding:2px 8px;border-radius:10px;font-size:0.7rem;font-weight:600;">{member_of}</span>'
    )
    role_pill = (
        f' <span style="display:inline-block;background:rgba(255,255,255,0.1);color:#ddd;'
        f'padding:2px 8px;border-radius:10px;font-size:0.7rem;">{role_text}</span>'
    ) if role_text else ""

    vip_w = p.get("vip_weeks", 0)
    xepa_w = p.get("xepa_weeks", 0)
    current_group = group
    group_label = "VIP" if current_group.lower() == "vip" else "Xepa"
    group_chip_color = "#f1c40f" if current_group.lower() == "vip" else "#888"

    # ‚îÄ‚îÄ Game stats from precomputed data ‚îÄ‚îÄ
    gs = p.get("game_stats", {})
    n_votes = gs.get("total_house_votes", 0)
    n_paredoes = gs.get("paredao_count", 0)
    cartola_pts = gs.get("cartola_total", 0)
    cartola_rank = gs.get("cartola_rank")
    prova_wins = gs.get("prova_wins", 0)

    # Votos chip (expandable if has detail)
    votes_detail_rows = ""
    for vd in gs.get("house_votes_detail", []):
        voters_str = ", ".join(vd.get("voters", []))
        votes_detail_rows += (
            f"<div style='margin-bottom:0.3rem;'>"
            f"<b>{vd.get('numero', '?')}¬∫ Pared√£o</b> ({vd.get('data', '')})<br>"
            f"<span style='color:#aaa;'>Votaram: {voters_str}</span></div>"
        )
    if votes_detail_rows:
        votos_chip = (
            f'<details style="display:inline;">'
            f'<summary class="rxn-chip" style="border:1px solid #e74c3c;cursor:pointer;list-style:none;">'
            f'üó≥Ô∏è <b>{n_votes}</b> {"voto" if n_votes == 1 else "votos"}</summary>'
            f'<div style="position:absolute;z-index:10;background:#1a1a2e;border:1px solid #444;'
            f'border-radius:8px;padding:0.5rem;margin-top:0.3rem;min-width:200px;font-size:0.78rem;'
            f'color:#ddd;box-shadow:0 4px 12px rgba(0,0,0,0.5);">'
            f'{votes_detail_rows}</div></details>'
        )
    else:
        votos_chip = (
            f'<span class="rxn-chip" style="border:1px solid #555;">'
            f'üó≥Ô∏è <b>{n_votes}</b> votos</span>'
        )

    # Pared√µes chip (expandable if has history)
    paredao_detail_rows = ""
    for ph in gs.get("paredao_history", []):
        res = ph.get("resultado", "?")
        res_color = "#e74c3c" if res == "Eliminado" else "#2ecc71" if res == "Sobreviveu" else "#f1c40f"
        vt = ph.get("voto_total")
        vt_str = f" ‚Äî {vt:.2f}%" if vt is not None else ""
        paredao_detail_rows += (
            f"<div style='margin-bottom:0.3rem;'>"
            f"<b>{ph.get('numero', '?')}¬∫ Pared√£o</b> ({ph.get('data', '')})<br>"
            f"<span style='color:#aaa;'>Como: {ph.get('como', '?')}</span> ¬∑ "
            f"<span style='color:{res_color};'>{res}{vt_str}</span></div>"
        )
    if n_paredoes > 0 and paredao_detail_rows:
        paredoes_chip = (
            f'<details style="display:inline;">'
            f'<summary class="rxn-chip" style="border:1px solid #e67e22;cursor:pointer;list-style:none;">'
            f'üèõÔ∏è <b>{n_paredoes}</b> {"pared√£o" if n_paredoes == 1 else "pared√µes"}</summary>'
            f'<div style="position:absolute;z-index:10;background:#1a1a2e;border:1px solid #444;'
            f'border-radius:8px;padding:0.5rem;margin-top:0.3rem;min-width:220px;font-size:0.78rem;'
            f'color:#ddd;box-shadow:0 4px 12px rgba(0,0,0,0.5);">'
            f'{paredao_detail_rows}</div></details>'
        )
    else:
        paredoes_chip = (
            f'<span class="rxn-chip" style="border:1px solid #555;">'
            f'üèõÔ∏è Nunca indicado</span>'
        )

    # Cartola chip
    rank_str = f" ({cartola_rank}¬∫)" if cartola_rank else ""
    cartola_chip = (
        f'<span class="rxn-chip" style="border:1px solid #9b59b6;">'
        f'üèÜ <b>{cartola_pts}</b> pts{rank_str}</span>'
    )

    # Prova chip (only if wins > 0)
    prova_chip = ""
    if prova_wins > 0:
        prova_chip = (
            f'<span class="rxn-chip" style="border:1px solid #2ecc71;">'
            f'ü•á <b>{prova_wins}</b> {"vit√≥ria" if prova_wins == 1 else "vit√≥rias"}</span>'
        )

    stat_chips = (
        f'<div class="stat-row">'
        f'<span class="rxn-chip" style="border:1px solid {score_color};">'
        f'<span style="font-weight:700;color:{score_color};">{score:+.1f}</span> Sentimento</span>'
        f'<span class="rxn-chip" style="border:1px solid #888;">'
        f'{balance:,} Saldo</span>'
        f'<span class="rxn-chip" style="border:1px solid {group_chip_color};">'
        f'<span style="font-weight:700;color:{group_chip_color};">{group_label}</span>'
        f' VIP {vip_w}√ó ¬∑ Xepa {xepa_w}√ó</span>'
        f'{votos_chip}{paredoes_chip}{cartola_chip}{prova_chip}'
        f'</div>'
    )

    # ‚ïê‚ïê‚ïê [2] STATUS STRIP ‚ïê‚ïê‚ïê
    ff_names_list = [f["name"] for f in false_friends[:5]]
    ff_names_str = ", ".join(ff_names_list)
    if len(false_friends) > 5:
        ff_names_str += f" +{len(false_friends) - 5}"
    vuln_detail = (
        f"<div class='sb-row'><span>Falsos amigos</span><span>{n_false_friends}</span></div>"
        f"<div class='sb-row'><span>Aliados</span><span>{n_allies}</span></div>"
        f"<div class='sb-row'><span>Inimigos</span><span>{n_enemies}</span></div>"
        f"<div class='sb-row'><span>Alvos ocultos</span><span>{len(blind_targets)}</span></div>"
    )
    if ff_names_list:
        vuln_detail += f"<div class='sb-muted'>Pontos cegos: {ff_names_str}</div>"
    vuln_chip = render_status_chip("üéØ", "Vulnerabilidade", risk_level, risk_color, vuln_detail)

    ext_score = scores_data.get("external", 0)
    ext_pos = scores_data.get("external_positive", 0)
    ext_count = scores_data.get("external_count", 0)
    ext_bd = scores_data.get("external_breakdown", {})
    ext_detail = "".join(
        f"<div class='sb-row'><span>{COMP_LABELS.get(k, k)}</span><span>{v:+.1f}</span></div>"
        for k, v in sorted(ext_bd.items(), key=lambda x: x[1])
    ) if ext_bd else "<div class='sb-muted'>Nenhum evento negativo recebido.</div>"
    ext_detail += f"<div class='sb-muted'>Total: {ext_score:.1f} | Positivos: +{ext_pos:.1f} | Eventos: {ext_count}</div>"
    impact_chip = render_status_chip("üß≠", "Impacto Negativo", external_level, external_color, ext_detail)

    anim_score = scores_data.get("animosity", 0)
    anim_bd = scores_data.get("animosity_breakdown", {})
    anim_detail = "".join(
        f"<div class='sb-row'><span>{COMP_LABELS.get(k, k)}</span><span>{v:+.1f}</span></div>"
        for k, v in sorted(anim_bd.items(), key=lambda x: x[1])
    ) if anim_bd else "<div class='sb-muted'>Nenhum evento negativo causado.</div>"
    anim_detail += f"<div class='sb-muted'>Total: {anim_score:.1f}</div>"
    hostility_chip = render_status_chip("üî•", "Hostilidade Gerada", animosity_level, animosity_color, anim_detail)

    plant_info = p.get("plant_index") or {}
    plant_chip_html = ""
    if plant_info and plant_info.get("score") is not None:
        score_roll = plant_info.get("rolling", plant_info.get("score", 0))
        score_val = int(round(score_roll))
        plant_week_num = plant_info.get("week")
        plant_color_hex = plant_color(score_val)
        bd_rows = []
        for item in plant_info.get("breakdown", []):
            pts = item.get("points", 0)
            if pts > 0:
                bd_rows.append(f"<div class='sb-row'><span>{item.get('label', '')}</span><span>+{pts}</span></div>")
        plant_detail = "".join(bd_rows) if bd_rows else "<div class='sb-muted'>Sem sinais fortes.</div>"
        plant_detail += f"<div class='sb-muted'>Semana {plant_week_num} | Rolling {score_roll:.1f}</div>"
        plant_chip_html = render_status_chip("üå±", "Planta Index", f"{score_val}/100", plant_color_hex, plant_detail)

    contra_chip = ""
    if sinc_contra_count:
        targets_txt = ", ".join(sinc_contra.get("targets", []))
        contra_detail = f"<div class='sb-muted'>Diz que n√£o gosta no Sincer√£o, mas d√° ‚ù§Ô∏è para: {targets_txt}</div>"
        contra_chip = render_status_chip("‚ö°", "Contradi√ß√£o", f"{sinc_contra_count}x", "#6f42c1", contra_detail)

    status_chips = vuln_chip + impact_chip + hostility_chip
    if plant_chip_html:
        status_chips += plant_chip_html
    if contra_chip:
        status_chips += contra_chip

    # ‚ïê‚ïê‚ïê [3] REACTIONS BAR ‚ïê‚ïê‚ïê
    rxn_received_chips = " ".join(
        f'<span class="rxn-chip">{r["emoji"]}√ó{r["count"]}</span>'
        for r in p.get('rxn_summary', [])
    )
    rxn_given_chips = " ".join(
        f'<span class="rxn-chip">{r["emoji"]}√ó{r["count"]}</span>'
        for r in p.get('given_summary', [])
    )

    # Expandable per-person reaction detail
    received_detail = p.get("received_detail", [])
    given_detail = p.get("given_detail", [])

    def build_rxn_detail_html(detail_list, label_prefix):
        if not detail_list:
            return ""
        # Group by emoji
        from collections import OrderedDict
        groups = OrderedDict()
        for d in detail_list:
            emoji = d.get("emoji", "?")
            groups.setdefault(emoji, []).append(d["name"])
        rows = []
        for emoji, names_list in groups.items():
            avatars_html = "".join(
                f'<div style="display:flex;flex-direction:column;align-items:center;width:50px;">'
                f'{av(n, 36, "#555")}'
                f'<div style="font-size:0.6rem;color:#aaa;margin-top:1px;text-align:center;'
                f'white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:50px;">{n.split()[0]}</div>'
                f'</div>'
                for n in names_list
            )
            rows.append(
                f'<div style="margin-bottom:0.4rem;">'
                f'<div style="font-size:0.8rem;margin-bottom:0.2rem;">{emoji} ({len(names_list)})</div>'
                f'<div style="display:flex;flex-wrap:wrap;gap:6px;">{avatars_html}</div>'
                f'</div>'
            )
        return "".join(rows)

    received_detail_html = build_rxn_detail_html(received_detail, "De")
    given_detail_html = build_rxn_detail_html(given_detail, "Para")

    # ‚ïê‚ïê‚ïê [4] RELATIONS GRID ‚ïê‚ïê‚ïê
    relations_html = (
        '<div style="color:#6c757d;font-size:0.7rem;margin-bottom:0.5rem;">'
        'Score = querid√¥metro + eventos acumulados (votos, poder, Sincer√£o). '
        'Positivo = rela√ß√£o boa ¬∑ Negativo = hostilidade.'
        '</div>'
    )
    if allies:
        relations_html += (
            f'<div class="relation-section" style="background:rgba(40,167,69,0.08);border-left:3px solid #28a745;">'
            f'<div class="relation-label" style="color:#28a745;">‚úÖ Aliados ({n_allies})</div>'
            f'{render_avatar_row(allies, "#28a745")}'
            f'<div style="color:#6c757d;font-size:0.75rem;margin-top:0.25rem;">Score positivo m√∫tuo. Votos seguros.</div>'
            f'</div>'
        )
    if enemies:
        enemy_emoji_text = ", ".join(
            f'{e["name"].split()[0]} ({e.get("my_emoji","?")}‚Üî{e.get("their_emoji","?")})'
            for e in enemies[:6]
        )
        relations_html += (
            f'<div class="relation-section" style="background:rgba(220,53,69,0.08);border-left:3px solid #dc3545;">'
            f'<div class="relation-label" style="color:#dc3545;">‚öîÔ∏è Inimigos ({n_enemies})</div>'
            f'{render_avatar_row(enemies, "#dc3545")}'
            f'<div style="color:#888;font-size:0.75rem;margin-top:0.25rem;">{enemy_emoji_text}</div>'
            f'<div style="color:#6c757d;font-size:0.75rem;">Score negativo m√∫tuo. Votos contra esperados.</div>'
            f'</div>'
        )
    if false_friends:
        ff_emoji_text = ", ".join(
            f'<span style="color:#dc3545;">{f["name"].split()[0]} ({f.get("their_emoji","?")})</span>'
            for f in false_friends[:6]
        )
        relations_html += (
            f'<div class="relation-section" style="background:rgba(255,193,7,0.1);border-left:3px solid #ffc107;">'
            f'<div class="relation-label" style="color:#ffc107;">‚ö†Ô∏è Falsos Amigos ({n_false_friends}) ‚Äî PERIGO</div>'
            f'{render_avatar_row(false_friends, "#ffc107")}'
            f'<div style="font-size:0.75rem;margin-top:0.25rem;">{ff_emoji_text}</div>'
            f'<div style="color:#6c757d;font-size:0.75rem;">Seu score √© positivo, o deles negativo. Votam contra 2-3√ó.</div>'
            f'</div>'
        )
    if blind_targets:
        bt_emoji_text = ", ".join(
            f'<span style="color:#6f42c1;">{b["name"].split()[0]} ({b.get("my_emoji","?")})</span>'
            for b in blind_targets[:6]
        )
        relations_html += (
            f'<div class="relation-section" style="background:rgba(111,66,193,0.08);border-left:3px solid #6f42c1;">'
            f'<div class="relation-label" style="color:#6f42c1;">üó°Ô∏è Alvos Ocultos ({len(blind_targets)})</div>'
            f'{render_avatar_row(blind_targets, "#6f42c1")}'
            f'<div style="font-size:0.75rem;margin-top:0.25rem;">{bt_emoji_text}</div>'
            f'<div style="color:#6c757d;font-size:0.75rem;">Seu score √© negativo, o deles positivo. N√£o sabem.</div>'
            f'</div>'
        )

    # ‚ïê‚ïê‚ïê [5] GAME DYNAMICS ‚ïê‚ïê‚ïê
    has_dynamics = (events.get('pos_week') or events.get('neg_week') or votes or sincerao_html
                    or events.get('pos_hist') or events.get('neg_hist'))
    dynamics_html = ""
    if has_dynamics:
        dynamics_inner = ""
        if events.get('pos_week'):
            dynamics_inner += (
                f"<div style='display:flex;align-items:center;gap:0.5rem;flex-wrap:wrap;margin-bottom:0.4rem;"
                f"background:rgba(40,167,69,0.06);padding:0.4rem 0.6rem;border-radius:8px;'>"
                f"<strong style='color:#28a745;font-size:0.85rem;'>+ Benef√≠cios</strong> {pos_html}</div>"
            )
        if events.get('neg_week'):
            dynamics_inner += (
                f"<div style='display:flex;align-items:center;gap:0.5rem;flex-wrap:wrap;margin-bottom:0.4rem;"
                f"background:rgba(220,53,69,0.06);padding:0.4rem 0.6rem;border-radius:8px;'>"
                f"<strong style='color:#dc3545;font-size:0.85rem;'>‚àí Preju√≠zos</strong> {neg_html}</div>"
            )
        if votes:
            dynamics_inner += (
                f"<div style='margin-bottom:0.4rem;'>"
                f"<strong style='color:#ffc107;font-size:0.85rem;display:block;margin-bottom:0.25rem;'>üó≥Ô∏è Votos recebidos</strong>"
                f"<div style='display:flex;flex-direction:column;gap:0.1rem;'>{votes_html}</div></div>"
            )
        if sincerao_html:
            dynamics_inner += (
                f"<div style='display:flex;align-items:center;gap:0.5rem;flex-wrap:wrap;margin-bottom:0.4rem;'>"
                f"<strong style='color:#17a2b8;font-size:0.85rem;'>üî• Sincer√£o</strong> {sincerao_html}</div>"
            )
        if events.get('pos_hist') or events.get('neg_hist'):
            dynamics_inner += (
                f"<div style='display:flex;align-items:center;gap:0.5rem;flex-wrap:wrap;'>"
                f"<strong style='color:#999;font-size:0.85rem;'>üìú Hist√≥rico</strong> {hist_html}</div>"
            )
        dynamics_html = (
            f'<div style="padding:0.6rem 1rem;border-bottom:1px solid #444;background:#2a2a2a;">'
            f'<div style="font-weight:700;font-size:0.85rem;color:#ccc;margin-bottom:0.4rem;">‚ö° Din√¢micas do Jogo</div>'
            f'<div style="font-size:0.9em;">{dynamics_inner}</div>'
            f'</div>'
        )

    # ‚ïê‚ïê‚ïê [6] CURIOSIDADES ‚ïê‚ïê‚ïê
    curiosities = p.get("curiosities", [])
    curiosities_html = ""
    if curiosities:
        items_html = "".join(
            f'<div class="curiosity-item">'
            f'<span class="curiosity-icon">{c["icon"]}</span>'
            f'<span>{c["text"]}</span></div>'
            for c in curiosities
        )
        curiosities_html = (
            f'<div style="padding:0.6rem 1rem;background:#2a2a2a;">'
            f'<div style="font-weight:700;font-size:0.85rem;color:#f1c40f;margin-bottom:0.3rem;">üí° Curiosidades</div>'
            f'{items_html}</div>'
        )

    # ‚ïê‚ïê‚ïê ASSEMBLE CARD ‚ïê‚ïê‚ïê
    print(f'''
<div id="perfil-{name_slug}" class="profile-card" style="margin-top:1.5rem;">

<!-- [1] Hero Header -->
<div style="background:linear-gradient(90deg,rgba(48,48,48,0.9),rgba(48,48,48,0.3));border-left:5px solid {cor_grupo};">
<div class="profile-hero-inner">
{avatar_img}
<div>
<h3 style="margin:0 0 0.25rem 0;color:#fff;font-size:1.3em;">{name}</h3>
<div style="display:flex;flex-wrap:wrap;gap:0.3rem;align-items:center;">
{group_pill}{role_pill}
</div>
{stat_chips}
</div>
</div>
</div>

<!-- [2] Status Strip -->
<div class="profile-status-strip">
{status_chips}
</div>

<!-- [3] Reactions -->
<div class="profile-reactions-grid">
<div>
<details class="rxn-detail">
<summary style="cursor:pointer;list-style:none;">
<div style="font-weight:600;color:#888;font-size:0.75rem;margin-bottom:0.3rem;">RECEBEU <span class="rxn-hint" style="font-weight:400;color:#666;font-size:0.65rem;">‚ñ∂ clique p/ detalhes</span></div>
{rxn_received_chips}
</summary>
<div style="padding-top:0.5rem;">{received_detail_html}</div>
</details>
</div>
<div>
<details class="rxn-detail">
<summary style="cursor:pointer;list-style:none;">
<div style="font-weight:600;color:#888;font-size:0.75rem;margin-bottom:0.3rem;">DEU <span class="rxn-hint" style="font-weight:400;color:#666;font-size:0.65rem;">‚ñ∂ clique p/ detalhes</span></div>
{rxn_given_chips}
</summary>
<div style="padding-top:0.5rem;">{given_detail_html}</div>
</details>
</div>
</div>

<!-- [4] Game Dynamics -->
{dynamics_html}

<!-- [5] Relations -->
<div class="profile-relations">
{relations_html if relations_html else '<div style="color:#777;font-size:0.85rem;">Sem rela√ß√µes classificadas.</div>'}
</div>

<!-- [6] Curiosidades -->
{curiosities_html}

</div>''')
```

```{python}
#| label: eliminated-section
#| output: asis

eliminated = index_data.get("eliminated", [])
if eliminated:
    status_emoji = {
        "eliminada": "üö™", "eliminado": "üö™",
        "desistente": "üè≥Ô∏è", "desclassificado": "‚õî", "desclassificada": "‚õî",
    }

    cards_html = ""
    for ex in eliminated:
        name = ex.get("name", "")
        avatar_url = ex.get("avatar", "")
        status = ex.get("status", "")
        label = ex.get("status_label", status)
        emoji = status_emoji.get(status, "‚ùå")
        exit_date = ex.get("exit_date", "")
        reason = ex.get("exit_reason", "")
        member_of_ex = ex.get("member_of", "?")
        cor = GROUP_COLORS.get(member_of_ex, "#666")
        paredao_num = ex.get("paredao_numero")

        try:
            from datetime import datetime as _dt
            date_fmt = _dt.strptime(exit_date, "%Y-%m-%d").strftime("%d/%m")
        except Exception:
            date_fmt = exit_date

        subtitle = f"{emoji} {label}"
        if paredao_num:
            subtitle += f" ({paredao_num}¬∫ Pared√£o)"
        if date_fmt:
            subtitle += f" ‚Äî {date_fmt}"

        av_img = (
            f'<img src="{avatar_url}" alt="{name}" '
            f'style="width:64px;height:64px;border-radius:50%;object-fit:cover;'
            f'border:3px solid {cor};flex-shrink:0;filter:grayscale(100%);opacity:0.7;">'
        ) if avatar_url else ""

        reason_html = f'<div style="font-size:0.8rem;color:#999;margin-top:0.3rem;">{reason}</div>' if reason else ""

        cards_html += f'''
<div style="display:flex;align-items:center;gap:1rem;padding:0.8rem 1rem;
    background:#1e1e1e;border-left:4px solid {cor};border-radius:8px;margin-bottom:0.5rem;">
{av_img}
<div>
<div style="font-weight:700;color:#ccc;font-size:1rem;">{name}</div>
<div style="font-size:0.85rem;color:#aaa;">{subtitle}</div>
{reason_html}
</div>
</div>'''

    print(f'''
<div style="margin-top:2rem;">
<h3 style="color:#999;font-size:1.1rem;margin-bottom:0.8rem;">üñ§ Participantes que sa√≠ram</h3>
{cards_html}
</div>''')
```

---

<div class="alert alert-info" role="alert">
<strong>üí° Sobre este painel:</strong> An√°lise estrat√©gica do BBB 26 combinando <strong>querid√¥metro</strong> (rea√ß√µes di√°rias), <strong>eventos de poder</strong> (indica√ß√µes, contragolpes, monstro), <strong>votos da casa</strong>, <strong>Sincer√£o</strong> e <strong>din√¢micas semanais</strong>. Os scores compostos usam pesos calibrados sem decay ‚Äî todos os eventos acumulam. Acertou <strong>68% dos votos</strong> nos 2 primeiros pared√µes. Acompanhamento desde 13 de janeiro de 2026.
</div>
